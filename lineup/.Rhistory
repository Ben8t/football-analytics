install.packages("tidyverse")
librarie(dplyr)
librairie(dplyr)
library(dplyr)
%S%
%>%
library(hrbrthemes)
library(jsonlite)
library(grid)
library(gridExtra)
install.packages("hrbrthemes")
install.packages("grid")
install.packages("grid")
install.packages("gridExtra")
install.packages('jsonlite')
library(jsonlite)
install.packages(igraph)
install.packages("igraph")
library(igraph)
install.packages("ggnetwork")
library(ggnetwork)
install.packages("intergraph")
library(tyderverse)
library(tidyverse)
library(ggdendro)
install.packages("ggdendro")
library(ggdendro)
USArrests
dist(USArrests)
a=USArrests
View(a)
df <- read.csv2("~/Downloads/Search results.csv")
View(df)
hc <- hclust(dist(df), "ave")
View(hc)
ggdendrogram(hc, rotate = FALSE, size = 2)
df2 = df2[1:50]
df2 = df[1:50]
df2 = df[1:50,]
hc <- hclust(dist(df2), "ave")
ggdendrogram(hc, rotate = FALSE, size = 2)
View(df2)
df2.rownames <- df2$Player
View(df2)
df2.rownames
hc <- hclust(dist(df2), "ave")
ggdendrogram(hc, rotate = FALSE, size = 2)
row.names(df2) = df2$Player
View(df2)
hc <- hclust(dist(df2), "ave")
ggdendrogram(hc, rotate = FALSE, size = 2)
row.names(df) = df$Player
hc <- hclust(dist(df), "ave")
ggdendrogram(hc, rotate = FALSE, size = 2)
View(df)
ggdendrogram(hc, rotate = TRUE, size = 2)
hc <- hclust(dist(df2), "ave")
ggdendrogram(hc, rotate = TRUE, size = 2)
ggdendrogram(hc, rotate = TRUE, size = 5)
ggdendrogram(hc, rotate = TRUE, size = 20)
library(ggplot2)
library(ggforce)
ggplot() +
geom_rect(aes(xmin = 0, xmax = 105, ymin = 0, ymax = 68), #entire pitch with FIFA dimensions
fill = "#EEEEEE",
colour = "#000000",
size = .5) +
geom_circle(aes(x0 = 105 / 2, y0 = 68 / 2, r = 9.15)) + #centre circle
geom_circle(aes(x0 = 11, y0 = 68 / 2, r = 9.15)) + #penalty arc
geom_circle(aes(x0 = 105 - 11, y0 = 68 / 2, r = 9.15)) + #penalty arc
geom_rect(aes(xmin = 0, xmax = 16.5, ymin = 68 / 2 - 7.32 / 2 - 16.5, ymax = 68 / 2 + 7.32 / 2 + 16.5), #penalty box
fill = "#EEEEEE",
colour = "#000000",
size = .5) +
geom_rect(aes(xmin = 105 - 16.5, xmax = 105, ymin = 68 / 2 - 7.32 / 2 - 16.5, ymax = 68 / 2 + 7.32 / 2 + 16.5),  #penalty box
fill = "#EEEEEE",
colour = "#000000",
size = .5) +
geom_point(aes(x = 11, y = 68 / 2)) + #penalty spot
geom_point(aes(x = 105 -11, y = 68 / 2)) + #penalty spot
geom_segment(aes(x = -.5, xend = -.5, y = 68 / 2 + 7.32 / 2, yend = 68 / 2 - 7.32 / 2)) + #goal
geom_segment(aes(x = 105.5, xend = 105.5, y = 68 / 2 + 7.32 / 2, yend = 68 / 2 - 7.32 / 2)) + #goal
geom_rect(aes(xmin = 0, xmax = 5.5, ymin = 68 / 2 - 7.32 / 2 - 5.5, ymax = 68 / 2 + 7.32 / 2 + 5.5), #6 yard box
fill = "#EEEEEE",
colour = "#000000",
size = .5) +
geom_rect(aes(xmin = 105 - 5.5, xmax = 105, ymin = 68 / 2 - 7.32 / 2 - 5.5, ymax = 68 / 2 + 7.32 / 2 + 5.5),  #6 yard box
fill = "#EEEEEE",
colour = "#000000",
size = .5) +
geom_segment(aes(x = 105 /2, y = 0, xend = 105 / 2, yend = 68)) + #halfway line
coord_fixed() +
theme(rect = element_blank(), #remove additional ggplot2 features: lines, axis, etc...
line = element_blank(),
legend.position = "none",
axis.title.y = element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank())
setwd("~/")
library(rvest)
library(plyr)
library(stringr)
library(ggplot2)
library(ggthemes)
library(hrbrthemes)
library(scales)
library(viridis)
library(extrafont)
library(grid)
library(gridExtra)
library(purrr)
library(dplyr)
# SCRAPPING ---------------------------------
# Attention Permier League / Champions league / FA CUP
#https://www.transfermarkt.com/arsenal-fc_liverpool-fc/aufstellung/spielbericht/2697986
# Return lineup
getLineUp <- function(url,team){
if(url %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% is_empty()){
}else{
print(url)
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[8]/div/div/div[2]/div[3]/p[1]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
}
#https://www.transfermarkt.com/arsenal-fc/spielplan/verein/11/plus/0?saison_id=2016
#https://www.transfermarkt.com/chelsea-fc/spielplan/verein/631/plus/0?saison_id=2016
#https://www.transfermarkt.com/ogc-nice/spielplan/verein/417/plus/0?saison_id=2016
# Return url list of match
getMatchUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[10]/div[1]/div[6]/div[3]/table/tbody/tr[',x,']/td[10]/a')) %>% html_attr(.,"href") %>% paste0("https://www.transfermarkt.com",.) %>% str_replace_all(.,'index','aufstellung'))
}
# Return home/away (ie 1/2) list
getHomeAwayUrl <- function(url){
ifelse(purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[10]/div[1]/div[6]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text())=="H",1,2)
}
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
all=do.call(rbind,all)
all$player = gsub("[[:space:]]*$","",all$player)
View(all)
write.csv(all,"arsenal_lineup35days.csv",row.names = FALSE)
setwd("~/Documents/DevData/FootScrapeViz/lineup")
# b=unique(all %>% select(player,post)) %>% arrange(desc(post))
all = read.csv2("data/arsenal_lineup35days.csv")
View(all)
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
# b=unique(all %>% select(player,post)) %>% arrange(desc(post))
all = read.csv2("data/arsenal_lineup35days.csv")
ggplot() +geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Petr Cech", "David Ospina", "Matt Macey","","Héctor Bellerín", "Mathieu Debuchy","Nacho Monreal", "Ainsley Maitland-Niles","Sead Kolasinac", "Laurent Koscielny", "Shkodran Mustafi", "Calum Chambers", "Per Mertesacker","Rob Holding","","Granit Xhaka","Aaron Ramsey", "Jack Wilshere", "Mesut Özil","Francis Coquelin", "Mohamed Elneny","","Alexis Sánchez","Henrikh Mkhitaryan", "Alex Iwobi", "Alex Oxlade-Chamberlain", "Theo Walcott","Reiss Nelson","","Alexandre Lacazette","Pierre-Emerick Aubameyang", "Olivier Giroud","Danny Welbeck", "Edward Nketiah"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="Arsenal Squad Rotation",subtitle="2017-2018 season 3/4",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
ggplot() +geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Petr Cech", "David Ospina", "Matt Macey","","Héctor Bellerín", "Mathieu Debuchy","Nacho Monreal", "Ainsley Maitland-Niles","Sead Kolasinac", "Laurent Koscielny", "Shkodran Mustafi", "Calum Chambers", "Per Mertesacker","Rob Holding","","Granit Xhaka","Aaron Ramsey", "Jack Wilshere", "Mesut Özil","Francis Coquelin", "Mohamed Elneny","","Alexis Sánchez","Henrikh Mkhitaryan", "Alex Iwobi", "Alex Oxlade-Chamberlain", "Theo Walcott","Reiss Nelson","","Alexandre Lacazette","Pierre-Emerick Aubameyang", "Olivier Giroud","Danny Welbeck", "Edward Nketiah"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="Arsenal Squad Rotation",subtitle="Premier League 2017-2018 season, matchday 35",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
