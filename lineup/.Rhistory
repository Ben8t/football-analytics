print(i)
for(i in sort(distinct(datasetALL,YEAR)$YEAR))
print(i)
dat3 = datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR>=2000)
all_dat=list()
for(i in sort(distinct(datasetALL,YEAR)$YEAR)){
all_dat[i]=datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==i)
}
all_dat
all_dat[2005]
all_dat[2005]$Radius
datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2005)
datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2)
datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2003)
all_dat[0]=datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2003)
all_dat[1]=datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2004)
all_dat[[0]]=datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2003)
all[[0]]=datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2003)
z=list()
z[0]=datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2003)
z[1]=datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2004)
z
z=list()
z[[0]]=datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2003)
z
z[[1]]=datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2003)
z[[2]]=datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==2004)
z
dat3 = datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR>=2000)
all_dat=list()
for(i in sort(distinct(datasetALL,YEAR)$YEAR)){
all_dat[[i]]=datasetALL %>% select(YEAR,Latitude,Longitude,Radius,Location) %>% filter(YEAR==i)
}
all_dat
library(plotly)
x <- seq(0,10, length.out = 1000)
# create data
aval <- list()
for(step in 1:11){
aval[[step]] <-list(visible = FALSE,
name = paste0('v = ', step),
x=x,
y=sin(step*x))
}
aval[3][[1]]$visible = TRUE
# create steps and plot all traces
steps <- list()
p <- plot_ly()
for (i in 1:11) {
p <- add_lines(p,x=aval[i][[1]]$x,  y=aval[i][[1]]$y, visible = aval[i][[1]]$visible,
name = aval[i][[1]]$name, type = 'scatter', mode = 'lines', hoverinfo = 'name',
line=list(color='00CED1'), showlegend = FALSE)
step <- list(args = list('visible', rep(FALSE, length(aval))),
method = 'restyle')
step$args[[2]][i] = TRUE
steps[[i]] = step
}
# add slider control to plot
p <- p %>%
layout(sliders = list(list(active = 3,
currentvalue = list(prefix = "Frequency: "),
steps = steps)))
p
library(plotly)
x <- seq(0,10, length.out = 1000)
# create data
aval <- list()
for(step in 1:11){
aval[[step]] <-list(visible = FALSE,
name = paste0('v = ', step),
x=x,
y=sin(step*x))
}
aval[3][[1]]$visible = TRUE
# create steps and plot all traces
steps <- list()
p <- plot_ly()
for (i in 1:11) {
p <- add_lines(p,x=aval[i][[1]]$x,  y=aval[i][[1]]$y, visible = aval[i][[1]]$visible,
name = aval[i][[1]]$name, type = 'scatter', mode = 'lines', hoverinfo = 'name',
line=list(color='00CED1'), showlegend = FALSE)
step <- list(args = list('visible', rep(FALSE, length(aval))),
method = 'restyle')
step$args[[2]][i] = TRUE
steps[[i]] = step
}
# add slider control to plot
p <- p %>%
layout(xaxis=(sliders = list(list(active = 3,
currentvalue = list(prefix = "Frequency: "),
steps = steps))))
p
dat4 = datasetALL %>% select(YEAR,Region,Location) %>% filter(Region==2)
datasetALL = read.csv("~/Documents/Cours/ING2/ExploreData/datasetALL.csv")
dat4 = datasetALL %>% select(YEAR,Region,Location) %>% filter(Region==2)
dat4
dat4 = datasetALL %>% select(YEAR,Region,Location) %>% filter(Region==1)
dat4
dat4 = datasetALL %>% select(Region,Location) %>% filter(Region==1)
dat4 = datasetALL %>% select(YEAR,Region,Location) %>% filter(Region==1)
dat4
dat4 = datasetALL %>% select(YEAR,Region,Location) %>% filter(Region==1) %>% summarise(count_number = n())
dat4
dat4 = datasetALL %>% select(YEAR,Region,Location) %>% filter(Region==1) %>% group_by(Location) %>% summarise(count_number = n())
dat4
dat4 = datasetALL %>% select(YEAR,Region,Location,Radius) %>% filter(Region==1) %>% group_by(Location) %>% summarise(count= n())
dat4
a=c(1,2,3,4,5)
a
sapply(a,function(x){
return(paste(a,"er"))
})
lapply(a,function(x){
return(paste(a,"er"))
})
sapply(a,function(x){
return(paste(x,"er"))
})
sapply(a,function(x){
return(paste0(x,"er"))
})
sapply(a,function(x){
if(x<2)
return(paste0(x,"er"))
else
return(paste0(x,"Ã¨me"))
})
library(ggplot2)
data=data.frame(lon=c(4.32,4.56,5.87,2.34,3.42),lat=c(48.7,46.5,38.9,45.3,50.3))
data
ggplot() + geom_density2d(data=data,aes(x=lon,y=lat))
ggplot() + geom_density2d(data=data,aes(x=lon,y=lat)) + geom_point(data=data,aes(x=lon,y=lat))
ggplot() + stat_density2d(data=data,aes(x=lon,y=lat)) + geom_point(data=data,aes(x=lon,y=lat))
ggplot() + stat_density2d(data=data,aes(x=lon,y=lat),size = 0.01, bins = 16, geom = 'polygon')) + geom_point(data=data,aes(x=lon,y=lat))
ggplot() + stat_density2d(data=data,aes(x=lon,y=lat),size = 0.01, bins = 16, geom = 'polygon') + geom_point(data=data,aes(x=lon,y=lat))
ggplot() + stat_density2d(data=data,aes(x=lon,y=lat),size = 0.01, bins = 16, geom = 'polygon') + geom_point(data=data,aes(x=lon,y=lat)) + scale_fill_gradient(low = "green", high = "red")
ggplot() + stat_density2d(data=data,aes(x=lon,y=lat),size = 0.01, bins = 16, geom = 'polygon') + scale_fill_gradient(low = "green", high = "red") + geom_point(data=data,aes(x=lon,y=lat))
ggplot() + stat_density2d(data=data,aes(x=lon,y=lat,fill = ..level.., alpha = ..level..),size = 0.01, bins = 16, geom = 'polygon') + scale_fill_gradient(low = "green", high = "red") + geom_point(data=data,aes(x=lon,y=lat))
getMatch <- function(url){
page = url %>% read_html()
player1= page %>% html_nodes(xpath="//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]/tbody/tr/td[1]/table") %>% html_table()
}
url="http://www.worldfootball.net/report/premier-league-2016-2017-arsenal-fc-liverpool-fc/"
page = url %>% read_html()
player1= page %>% html_nodes(xpath="//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]/tbody/tr/td[1]/table") %>% html_table()
library(dplyr)
page = url %>% read_html()
player1= page %>% html_nodes(xpath="//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]/tbody/tr/td[1]/table") %>% html_table()
library(rvest)
page = url %>% read_html()
player1= page %>% html_nodes(xpath="//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]/tbody/tr/td[1]/table") %>% html_table()
page = url %>% read_html()
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]/tbody/tr/td[1]/table') %>% html_table()
player1
page = url %>% read_html()
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]/tbody/tr/td[1]/table') %>% nth(1) %>% html_table()
page = url %>% read_html()
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]/tbody/tr/td[1]/table')
player1
page = url %>% read_html()
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4])
)
player1
)
)
''
')'
page = url %>% read_html()
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]')
player1
page = url %>% read_html()
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]') %>% html_table()
page = url %>% read_html()
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]') %>% html_table(fill=T)
player1
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]/tbody/tr/td[1]/table') %>% html_table()
player1
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]/tbody/tr/td[1]/table') %>% html_table(fill=T)
player1
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]/tbody/tr/td[1]/table')
player1
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]/tbody/tr/td[1]')
player1
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]')
player1
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]') %>% nth(1)
player1
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]') %>% nth(1) %>% read_html()
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]') %>% nth(1) %>% html_nodes('table')
player1
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]') %>% nth(1) %>% html_nodes('table') %>% nth(1)
player1
player1= page %>% html_nodes(xpath='//*[@id="site"]/div[3]/div[1]/div/div[6]/div/table[4]') %>% nth(1) %>% html_nodes('table') %>% nth(1) %>% html_table()
player1
View(player1)
player1$X2
libray(string_R)
library(stringr)
player1$X2 %>% str_replace_all(.,'\\t','')
player1$X2 %>% str_replace_all(.,'\\t\\n','')
player1$X2 %>% str_replace_all(.,'\\t|\\n','')
player1$X2 %>% str_replace_all(.,'\\t|\\n|\\d','')
player1$X2 %>% str_replace_all(.,'\\t|\\n|\\d|\\'','')
player1$X2 %>% str_replace_all(.,'\\t|\\n|\\d|\\"'"','')
)
''
''
'
""
player1$X2 %>% str_replace_all(.,"\\t|\\n|\\d|'",'')
a=data.frame(name="sanchez")
a
a=data.frame(name="sanchez",day1=1,day2=0,day3=3,day4=4)
a
library(rvest)
library(plyr)
library(stringr)
library(ggplot2)
library(ggthemes)
library(scales)
library(viridis)
library(extrafont)
library(grid)
library(gridExtra)
library(dplyr)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[5]') %>% html_text()
}
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[5]')) %>% html_text()
}
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[5]')) %>% html_text())
}
a='https://www.transfermarkt.com/arsenal-fc/spielplan/verein/11/plus/0?saison_id=2016'
getHomeAwayUrl(a)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text())
}
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text() %>% ifelse(.=="H",1,2))
}
getHomeAwayUrl(a)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text() %>% ifelse(=="H",1,2))
}
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text()) %>% ifelse(.=="H",1,2)
}
getHomeAwayUrl(a)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text())
}
getHomeAwayUrl(a)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text() %>% ifelse(~.=="H",1,2))
}
getHomeAwayUrl(a)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text() %>% ~ifelse(.=="H",1,2))
}
getHomeAwayUrl(a)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text() %>% ifelse(.=="H",1,2))
}
getHomeAwayUrl(a)
map(1:3,ifelse(.==1,2,3))
library(purrr)
map(1:3,ifelse(.==1,2,3))
map(1:3,ifelse(~.==1,2,3))
map(1:3,ifelse(~.=1,2,3))
map(1:3,ifelse(==1,2,3))
map(1:3,ifelse(.==1,2,3))
map(1:3,ifelse())
map(1:3,ifelse(),.==1,2)
map(1:3,ifelse(),.==1,2,3)
map(1:3,ifelse(),~.==1,2,3)
map(1:3,.+1)
map(1:3,~.+1)
map(1:3,if(~.==1,1,2))
map(1:3,if)
1 %>% ifelse(.==1,2,3)
1 %>% ifelse(~.==1,2,3)
1 %>% ifelse(2,3)
1 %>% ifelse(<2,3)
1 %>% ifelse(>2,3)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text() %>% ~ifelse(.=="H",1,2))
}
getHomeAwayUrl(a)
ifelse(1:3==1,2,3)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text()) %>% ifelse(.=="H",1,2)
}
getHomeAwayUrl(a)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text()) %>% ~ifelse(.=="H",1,2)
}
getHomeAwayUrl(a)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text()) %>% ifelse(~.=="H",1,2)
}
getHomeAwayUrl(a)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text() %>% if(.=="H") 1 else 2)
}
getHomeAwayUrl(a)
getHomeAwayUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text() %>% if(~.=="H") 1 else 2)
}
getHomeAwayUrl(a)
getHomeAwayUrl <- function(url){
ifelse(purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text())=="H",1,2)
}
getHomeAwayUrl(a)
do.call(rbind,map2(getMatchUrl(url),getHomeAwayUrl(url),getLineUp(x,y))
)
getLineUp <- function(url,team){
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[7]/div/div/div[2]/div[3]/p[2]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
titu$lineup="player"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
bench$lineup="bench"
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
titu$lineup="player"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
bench$lineup="bench"
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
#https://www.transfermarkt.com/arsenal-fc/spielplan/verein/11/plus/0?saison_id=2016
getMatchUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[10]/a')) %>% html_attr(.,"href") %>% paste0("https://www.transfermarkt.com",.) %>% str_replace_all(.,'index','aufstellung'))
}
getHomeAwayUrl <- function(url){
ifelse(purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text())=="H",1,2)
}
list=getMatchUrl("https://www.transfermarkt.com/arsenal-fc/spielplan/verein/11/plus/0?saison_id=2016")
do.call(rbind,map2(getMatchUrl(url),getHomeAwayUrl(url),getLineUp(x,y))
)
do.call(rbind,map2(getMatchUrl(url),getHomeAwayUrl(url),getLineUp(getMatchUrl(url),getHomeAwayUrl(url))))
map(getMatchUrl(url),getHomeAwayurl(url),function(a,b)getLineUp(a,b))
map2(getMatchUrl(url),getHomeAwayurl(url),function(a,b)getLineUp(a,b))
url
url="https://www.transfermarkt.com/arsenal-fc/spielplan/verein/11/plus/0?saison_id=2016"
map2(getMatchUrl(url),getHomeAwayurl(url),function(a,b)getLineUp(a,b))
map(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
a=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
a
a=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
a
save.image("~/Documents/DevData/scrape/lineup/variableTMP.RData")
all = do.call(rbind,a)
library(ggplot2)
ggplot() + geom_point(data=all,aes(x=matchday,y=player))
ggplot() + geom_point(data=all,aes(x=matchday,y=player,color=lineup))
ggplot() + geom_point(data=all,aes(x=matchday,y=player %>% str_replace(.,"\\s",""),color=lineup))
library(stringr)
ggplot() + geom_point(data=all,aes(x=matchday,y=player %>% str_replace(.,"\\s",""),color=lineup))
all2 = all
all2$player = str_replace_all(all$player,"\\s","")
View(all2)
ggplot() + geom_point(data=all2,aes(x=matchday,y=player,color=lineup))
library(ggplot2)
ggplot() +
geom_rect(aes(xmin = 0, xmax = 100, ymin = 0, ymax = 100), fill = NA, colour = "#000000", size = 1) +
geom_rect(aes(xmin = 0, xmax = 50, ymin = 0, ymax = 100), fill = NA, colour = "#000000", size = 1) +
geom_rect(aes(xmin = 17, xmax = 0, ymin = 21, ymax = 79), fill = NA, colour = "#000000", size = 1) +
geom_rect(aes(xmin = 83, xmax = 100, ymin = 21, ymax = 79), fill = NA, colour = "#000000", size = 1) +
geom_rect(aes(xmin = 0, xmax = 6, ymin = 36.8, ymax = 63.2), fill = NA, colour = "#000000", size = 1) +
geom_rect(aes(xmin = 100, xmax = 94, ymin = 36.8, ymax = 63.2), fill = NA, colour = "#000000", size = 1) +
theme(rect = element_blank(),
line = element_blank(),
text = element_blank())
setwd("~/Documents/DevData/scrape/lineup")
library(rvest)
library(plyr)
library(stringr)
library(ggplot2)
library(ggthemes)
library(hrbrthemes)
library(scales)
library(viridis)
library(extrafont)
library(grid)
library(gridExtra)
library(purrr)
library(dplyr)
getLineUp <- function(url,team){
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[7]/div/div/div[2]/div[3]/p[2]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
#https://www.transfermarkt.com/arsenal-fc/spielplan/verein/11/plus/0?saison_id=2016
#https://www.transfermarkt.com/chelsea-fc/spielplan/verein/631/plus/0?saison_id=2016
#https://www.transfermarkt.com/ogc-nice/spielplan/verein/417/plus/0?saison_id=2016
# Return url list of match
getMatchUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[6]/div[3]/table/tbody/tr[',x,']/td[10]/a')) %>% html_attr(.,"href") %>% paste0("https://www.transfermarkt.com",.) %>% str_replace_all(.,'index','aufstellung'))
}
# Return home/away (ie 1/2) list
getHomeAwayUrl <- function(url){
ifelse(purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[6]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text())=="H",1,2)
}
url='https://www.transfermarkt.com/ogc-nice/spielplan/verein/417/plus/0?saison_id=2016'
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
all=do.call(rbind,all)
all$player = gsub("[[:space:]]*$","",all$player)
u=getMatchUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[6]/div[3]/table/tbody/tr[',x,']/td[10]/a')) %>% html_attr(.,"href") %>% paste0("https://www.transfermarkt.com",.) %>% str_replace_all(.,'index','aufstellung'))
}
u
url
u = getMatchUrl(url)
u
# Return lineup
getLineUp <- function(url,team){
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[7]/div/div/div[2]/div[3]/p[2]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
#https://www.transfermarkt.com/arsenal-fc/spielplan/verein/11/plus/0?saison_id=2016
#https://www.transfermarkt.com/chelsea-fc/spielplan/verein/631/plus/0?saison_id=2016
#https://www.transfermarkt.com/ogc-nice/spielplan/verein/417/plus/0?saison_id=2016
# Return url list of match
getMatchUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[10]/a')) %>% html_attr(.,"href") %>% paste0("https://www.transfermarkt.com",.) %>% str_replace_all(.,'index','aufstellung'))
}
# Return home/away (ie 1/2) list
getHomeAwayUrl <- function(url){
ifelse(purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text())=="H",1,2)
}
url='https://www.transfermarkt.com/ogc-nice/spielplan/verein/417/plus/0?saison_id=2016'
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
all=do.call(rbind,all)
all$player = gsub("[[:space:]]*$","",all$player)
View(all)
write.csv2(all,"./data/nice_lineup.csv",row.names=FALSE)
all = read.csv2("./data/nice_lineup.csv")
View(all)
b=unique(all %>% select(player,post)) %>% arrange(desc(post))
unique(b$player)
View(b)
ggplot() + geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Yoann Cardinale","Walter BenÃ­tez","Simon Pouplin","Mouez Hassen","","Malang Sarr","Paul Baysse","Mathieu Bodmer","Dante","Arnaud Souquet","Maxime Le Marchand","Gautier Lloris","Dalbert","Olivier Boscagli","Ricardo Pereira","Patrick Burner","","RÃ©mi Walter","Albert Rafetraniaina","Vincent Koziello","Jean MichaÃ«l Seri","Wylan Cyprien","Mounir Obbadi","Franck Honorat","","YounÃ¨s Belhanda","Valentin Eysseric","Arnaud Lusamba","SaÃ¯d Benrahma","Julien Vercautere","Bassem Srarf","Hicham Mahou","Vincent Marcel","","Mario Balotelli","Alassane PlÃ©a","Alexy Bosetti","MickaÃ«l Le Bihan","Anastasios Donis"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="Tottenham Squad Rotation",subtitle="2016-2017 season",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
ggplot() + geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Yoan Cardinale","Walter BenÃ­tez","Simon Pouplin","Mouez Hassen","","Malang Sarr","Paul Baysse","Mathieu Bodmer","Dante","Arnaud Souquet","Maxime Le Marchand","Gautier Lloris","Dalbert","Olivier Boscagli","Ricardo Pereira","Patrick Burner","","RÃ©mi Walter","Albert Rafetraniaina","Vincent Koziello","Jean MichaÃ«l Seri","Wylan Cyprien","Mounir Obbadi","Franck Honorat","","YounÃ¨s Belhanda","Valentin Eysseric","Arnaud Lusamba","SaÃ¯d Benrahma","Julien Vercautere","Bassem Srarf","Hicham Mahou","Vincent Marcel","","Mario Balotelli","Alassane PlÃ©a","Anastasios Donis","Alexy Bosetti","MickaÃ«l Le Bihan"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="OGN Nice Squad Rotation",subtitle="2016-2017 season",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
ggplot() + geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Yoan Cardinale","Walter BenÃ­tez","Simon Pouplin","Mouez Hassen","","Malang Sarr","Paul Baysse","Mathieu Bodmer","Dante","Arnaud Souquet","Maxime Le Marchand","Gautier Lloris","Dalbert","Olivier Boscagli","Ricardo Pereira","Patrick Burner","","RÃ©mi Walter","Albert Rafetraniaina","Vincent Koziello","Jean MichaÃ«l Seri","Wylan Cyprien","Mounir Obbadi","","YounÃ¨s Belhanda","Valentin Eysseric","Arnaud Lusamba","SaÃ¯d Benrahma","Julien Vercautere","Bassem Srarf","Hicham Mahou","Vincent Marcel","","Mario Balotelli","Alassane PlÃ©a","Anastasios Donis","Alexy Bosetti","MickaÃ«l Le Bihan"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="OGN Nice Squad Rotation",subtitle="2016-2017 season",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
ggplot() + geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Yoan Cardinale","Walter BenÃ­tez","Simon Pouplin","Mouez Hassen","","Malang Sarr","Paul Baysse","Mathieu Bodmer","Dante","Arnaud Souquet","Maxime Le Marchand","Gautier Lloris","Dalbert","Olivier Boscagli","Ricardo Pereira","Patrick Burner","","RÃ©mi Walter","Vincent Koziello","Jean MichaÃ«l Seri","Wylan Cyprien","Mounir Obbadi","Albert Rafetraniaina","","YounÃ¨s Belhanda","Valentin Eysseric","Arnaud Lusamba","SaÃ¯d Benrahma","Julien Vercautere","Bassem Srarf","Hicham Mahou","Vincent Marcel","","Mario Balotelli","Alassane PlÃ©a","Anastasios Donis","Alexy Bosetti","MickaÃ«l Le Bihan"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="OGN Nice Squad Rotation",subtitle="2016-2017 season",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
ggplot() + geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Yoan Cardinale","Walter BenÃ­tez","Simon Pouplin","Mouez Hassen","","Malang Sarr","Paul Baysse","Mathieu Bodmer","Dante","Arnaud Souquet","Maxime Le Marchand","Gautier Lloris","Dalbert","Olivier Boscagli","Ricardo Pereira","Patrick Burner","","Jean MichaÃ«l Seri","Wylan Cyprien","RÃ©mi Walter","Vincent Koziello","Mounir Obbadi","Albert Rafetraniaina","","YounÃ¨s Belhanda","Valentin Eysseric","Arnaud Lusamba","SaÃ¯d Benrahma","Julien Vercautere","Bassem Srarf","Hicham Mahou","Vincent Marcel","","Mario Balotelli","Alassane PlÃ©a","Anastasios Donis","Alexy Bosetti","MickaÃ«l Le Bihan"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="OGN Nice Squad Rotation",subtitle="2016-2017 season",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
ggplot() + geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Yoan Cardinale","Walter BenÃ­tez","Simon Pouplin","Mouez Hassen","","Malang Sarr","Paul Baysse","Mathieu Bodmer","Dante","Arnaud Souquet","Maxime Le Marchand","Gautier Lloris","Dalbert","Olivier Boscagli","Ricardo Pereira","Patrick Burner","","Jean MichaÃ«l Seri","Wylan Cyprien","RÃ©mi Walter","Vincent Koziello","Mounir Obbadi","Albert Rafetraniaina","","YounÃ¨s Belhanda","Valentin Eysseric","Arnaud Lusamba","SaÃ¯d Benrahma","Julien Vercauteren","Bassem Srarfi","Hicham Mahou","Vincent Marcel","","Mario Balotelli","Alassane PlÃ©a","Anastasios Donis","Alexy Bosetti","MickaÃ«l Le Bihan"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="OGN Nice Squad Rotation",subtitle="2016-2017 season",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
ggplot() + geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Yoan Cardinale","Walter BenÃ­tez","Simon Pouplin","Mouez Hassen","","Malang Sarr","Paul Baysse","Mathieu Bodmer","Dante","Arnaud Souquet","Maxime Le Marchand","Ricardo Pereira","Dalbert","Gautier Lloris","Olivier Boscagli","Patrick Burner","","Jean MichaÃ«l Seri","Wylan Cyprien","RÃ©mi Walter","Vincent Koziello","Mounir Obbadi","Albert Rafetraniaina","","YounÃ¨s Belhanda","Valentin Eysseric","Arnaud Lusamba","SaÃ¯d Benrahma","Julien Vercauteren","Bassem Srarfi","Hicham Mahou","Vincent Marcel","","Mario Balotelli","Alassane PlÃ©a","Anastasios Donis","Alexy Bosetti","MickaÃ«l Le Bihan"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="OGN Nice Squad Rotation",subtitle="2016-2017 season",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
ggplot() + geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Yoan Cardinale","Walter BenÃ­tez","Simon Pouplin","Mouez Hassen","","Malang Sarr","Paul Baysse","Mathieu Bodmer","Dante","Arnaud Souquet","Maxime Le Marchand","Ricardo Pereira","Dalbert","Olivier Boscagli","Patrick Burner","Gautier Lloris","","Jean MichaÃ«l Seri","Wylan Cyprien","RÃ©mi Walter","Vincent Koziello","Mounir Obbadi","Albert Rafetraniaina","","YounÃ¨s Belhanda","Valentin Eysseric","Arnaud Lusamba","SaÃ¯d Benrahma","Julien Vercauteren","Bassem Srarfi","Hicham Mahou","Vincent Marcel","","Mario Balotelli","Alassane PlÃ©a","Anastasios Donis","Alexy Bosetti","MickaÃ«l Le Bihan"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="OGN Nice Squad Rotation",subtitle="2016-2017 season",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
ggplot() + geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Yoan Cardinale","Walter BenÃ­tez","Mouez Hassen","Simon Pouplin","","Malang Sarr","Paul Baysse","Mathieu Bodmer","Dante","Arnaud Souquet","Maxime Le Marchand","Ricardo Pereira","Dalbert","Olivier Boscagli","Patrick Burner","Gautier Lloris","","Jean MichaÃ«l Seri","Wylan Cyprien","RÃ©mi Walter","Vincent Koziello","Mounir Obbadi","Albert Rafetraniaina","","YounÃ¨s Belhanda","Valentin Eysseric","Arnaud Lusamba","SaÃ¯d Benrahma","Julien Vercauteren","Bassem Srarfi","Hicham Mahou","Vincent Marcel","","Mario Balotelli","Alassane PlÃ©a","Anastasios Donis","Alexy Bosetti","MickaÃ«l Le Bihan"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="OGN Nice Squad Rotation",subtitle="2016-2017 season",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
