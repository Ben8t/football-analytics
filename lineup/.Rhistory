hc <- hclust(dist(df), "ave")
ggdendrogram(hc, rotate = FALSE, size = 2)
View(df)
ggdendrogram(hc, rotate = TRUE, size = 2)
hc <- hclust(dist(df2), "ave")
ggdendrogram(hc, rotate = TRUE, size = 2)
ggdendrogram(hc, rotate = TRUE, size = 5)
ggdendrogram(hc, rotate = TRUE, size = 20)
#lineup
library(rvest)
library(plyr)
library(stringr)
library(ggplot2)
library(ggthemes)
library(hrbrthemes)
library(scales)
library(viridis)
library(extrafont)
library(grid)
library(gridExtra)
library(purrr)
library(dplyr)
# SCRAPPING ---------------------------------
# Attention Permier League / Champions league / FA CUP
#https://www.transfermarkt.com/arsenal-fc_liverpool-fc/aufstellung/spielbericht/2697986
# Return lineup
getLineUp <- function(url,team){
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[7]/div/div/div[2]/div[3]/p[2]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
#https://www.transfermarkt.com/arsenal-fc/spielplan/verein/11/plus/0?saison_id=2016
#https://www.transfermarkt.com/chelsea-fc/spielplan/verein/631/plus/0?saison_id=2016
#https://www.transfermarkt.com/ogc-nice/spielplan/verein/417/plus/0?saison_id=2016
# Return url list of match
getMatchUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[10]/a')) %>% html_attr(.,"href") %>% paste0("https://www.transfermarkt.com",.) %>% str_replace_all(.,'index','aufstellung'))
}
# Return home/away (ie 1/2) list
getHomeAwayUrl <- function(url){
ifelse(purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[9]/div[1]/div[5]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text())=="H",1,2)
}
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
#https://www.transfermarkt.com/arsenal-fc_liverpool-fc/aufstellung/spielbericht/2697986
# Return lineup
getLineUp <- function(url,team){
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[7]/div/div/div[2]/div[3]/p[2]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div[6]/div[3]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div[6]/div[3]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
getMatchUrl(url,1)
uel
url
getLineUp(url,1)
getMatchUrl(url)
getMatchUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[10]/div[1]/div[6]/div[3]/table/tbody/tr[',x,']/td[10]/a')) %>% html_attr(.,"href") %>% paste0("https://www.transfermarkt.com",.) %>% str_replace_all(.,'index','aufstellung'))
}
getMatchUrl(url)
# SCRAPPING ---------------------------------
# Attention Permier League / Champions league / FA CUP
#https://www.transfermarkt.com/arsenal-fc_liverpool-fc/aufstellung/spielbericht/2697986
# Return lineup
getLineUp <- function(url,team){
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[7]/div/div/div[2]/div[3]/p[2]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[9]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[10]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
#https://www.transfermarkt.com/arsenal-fc/spielplan/verein/11/plus/0?saison_id=2016
#https://www.transfermarkt.com/chelsea-fc/spielplan/verein/631/plus/0?saison_id=2016
#https://www.transfermarkt.com/ogc-nice/spielplan/verein/417/plus/0?saison_id=2016
# Return url list of match
getMatchUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[10]/div[1]/div[6]/div[3]/table/tbody/tr[',x,']/td[10]/a')) %>% html_attr(.,"href") %>% paste0("https://www.transfermarkt.com",.) %>% str_replace_all(.,'index','aufstellung'))
}
# Return home/away (ie 1/2) list
getHomeAwayUrl <- function(url){
ifelse(purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[10]/div[1]/div[6]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text())=="H",1,2)
}
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
getHomeAwayUrl(url)
u="https://www.transfermarkt.com/spielbericht/aufstellung/spielbericht/2872115"
getLineUp(u,1)
page = u %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[7]/div/div/div[2]/div[3]/p[2]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
page %>% html_nodes(xpath='//*[@id="main"]/div[7]/div/div/div[2]/div[3]/p[2]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T)
page %>% html_nodes(xpath='//*[@id="main"]/div[7]/div/div/div[2]/div[3]/p[2]/a[1]')
page %>% html_nodes(xpath='//*[@id="main"]/div[8]/div/div/div[2]/div[3]/p[1]/a[1]') %>% html_text()
page %>% html_nodes(xpath='//*[@id="main"]/div[8]/div/div/div[2]/div[3]/p[1]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
getLineUp <- function(url,team){
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[8]/div/div/div[2]/div[3]/p[1]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
getLineUp(u,1)
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
all=do.call(rbind,all)
all$player = gsub("[[:space:]]*$","",all$player)
getHomeAwayUrl(u)
getHomeAwayUrl(url)
getHomeAwayUrl(u)
getHomeAwayUrl(url)
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
# Return lineup
getLineUp <- function(url,team){
print(url)
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[8]/div/div/div[2]/div[3]/p[1]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
#https://www.transfermarkt.com/arsenal-fc/spielplan/verein/11/plus/0?saison_id=2016
#https://www.transfermarkt.com/chelsea-fc/spielplan/verein/631/plus/0?saison_id=2016
#https://www.transfermarkt.com/ogc-nice/spielplan/verein/417/plus/0?saison_id=2016
# Return url list of match
getMatchUrl <- function(url){
purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[10]/div[1]/div[6]/div[3]/table/tbody/tr[',x,']/td[10]/a')) %>% html_attr(.,"href") %>% paste0("https://www.transfermarkt.com",.) %>% str_replace_all(.,'index','aufstellung'))
}
# Return home/away (ie 1/2) list
getHomeAwayUrl <- function(url){
ifelse(purrr::map(1:38,function(x) url %>% read_html() %>% html_nodes(xpath=paste0('//*[@id="main"]/div[10]/div[1]/div[6]/div[3]/table/tbody/tr[',x,']/td[4]')) %>% html_text())=="H",1,2)
}
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
url %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table')
u %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
i = https://www.transfermarkt.com/spielbericht/aufstellung/spielbericht/2872356
i = "https://www.transfermarkt.com/spielbericht/aufstellung/spielbericht/2872356"
i %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
i %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table')
i %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') = = {xml_nodeset(0)}
i %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') =={xml_nodeset(0)}
i %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') =="{xml_nodeset(0)}"
1==2
"ab"=="cv"
i %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% str()
i %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% is.null
i %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% is_empty()
u %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% is_empty()
getLineUp <- function(url,team){
if(url %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% is_empty()){
break
}
print(url)
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[8]/div/div/div[2]/div[3]/p[1]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
# Return lineup
getLineUp <- function(url,team){
if(url %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% is_empty()){
print('No data')
}else{
print(url)
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[8]/div/div/div[2]/div[3]/p[1]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
}
tb$matchday=matchday
return(tb)
}
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
getLineUp <- function(url,team){
if(url %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% is_empty()){
print('No data')
}else{
print(url)
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[8]/div/div/div[2]/div[3]/p[1]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
}
return(tb)
}
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
getLineUp <- function(url,team){
if(url %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% is_empty()){
print('No data')
}else{
print(url)
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[8]/div/div/div[2]/div[3]/p[1]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
}
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
View(all)
all=do.call(rbind,all)
all$player = gsub("[[:space:]]*$","",all$player)
View(all)
getLineUp <- function(url,team){
if(url %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% is_empty()){
next
}else{
print(url)
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[8]/div/div/div[2]/div[3]/p[1]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
}
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
all=do.call(rbind,all)
all$player = gsub("[[:space:]]*$","",all$player)
getLineUp <- function(url,team){
if(url %>% read_html() %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% is_empty()){
}else{
print(url)
page = url %>% read_html()
matchday = page %>% html_nodes(xpath='//*[@id="main"]/div[8]/div/div/div[2]/div[3]/p[1]/a[1]') %>% html_text() %>% str_split(.,"\\.",simplify=T) %>% .[[1]] %>% as.numeric()
if(team==1){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$lineup="starting"
titu$post=post_titu
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[1]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
if(team==2){
page = url %>% read_html()
titu=page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_titu = page %>% html_nodes(xpath='//*[@id="main"]/div[12]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
titu$post=post_titu
titu$lineup="starting"
bench= page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table')%>% html_table(fill=T) %>% nth(1) %>% .$X4 %>% na.omit() %>% as.character() %>% str_replace_all(.,"\\(.*\\)",'') %>% tibble(player=.)
post_bench = page %>% html_nodes(xpath='//*[@id="main"]/div[13]/div[2]/div/div[2]/table') %>% html_table(fill=T) %>% nth(1) %>% .$X5 %>% na.omit() %>% as.character() %>% str_replace_all(.,",.*","")
bench$lineup="bench"
bench$post = post_bench
tb=rbind(titu,bench)
}
tb$matchday=matchday
return(tb)
}
}
url = "https://www.transfermarkt.com/fc-arsenal/spielplan/verein/11/plus/0?saison_id=2017"
all=map2(getMatchUrl(url),getHomeAwayUrl(url),function(a,b)getLineUp(a,b))
all=do.call(rbind,all)
all$player = gsub("[[:space:]]*$","",all$player)
all %>% write.csv2(.,file="data/arsenal1718.csv")
all %>% write.csv2(.,file="data/arsenal1718.csv")
write.csv(all,"data/arsenal1718.csv")
write.csv(all,"data/arsenal1718.csv",a=TRUE)
write(all,"data/arsenal1718.csv")
b=unique(all %>% select(player,post)) %>% arrange(desc(post))
View(b)
View(all)
setwd("~/Documents/DevData/FootScrapeViz/lineup")
all %>% write.csv2(.,file="data/arsenal1718.csv")
all %>% write.csv2(.,file="data/arsenal1718.csv",row.names=FALSE)
b=unique(all %>% select(player,post)) %>% arrange(desc(post))
all = read.csv2("data/arsenal1718.csv")
ggplot() +geom_point(data=all,aes(x=matchday,y=player,color=lineup),size=2) + scale_colour_manual(values=c("#ff8a80","#69f0ae")) + scale_y_discrete(limits=c("Petr Cech", "David Ospina", "Emiliano Martínez","Matt Macey","","Héctor Bellerín","Carl Jenkinson", "Mathieu Debuchy","Nacho Monreal", "Kieran Gibbs", "Laurent Koscielny", "Shkodran Mustafi", "Gabriel Paulista", "Per Mertesacker","Rob Holding", "Calum Chambers","","Granit Xhaka","Aaron Ramsey", "Santi Cazorla","Mesut Özil","Francis Coquelin", "Mohamed Elneny","Jack Wilshere","Jeff Reine-Adelaide","","Alex Oxlade-Chamberlain", "Ainsley Maitland-Niles","Alex Iwobi", "Theo Walcott","Alexis Sánchez","","Olivier Giroud","Danny Welbeck","Lucas Pérez","Chuba Akpom"))+ scale_x_continuous(breaks=c(1,10,20,30,38))+labs(x="Matchday", y="",title="Arsenal Squad Rotation",subtitle="2016-2017 season",caption="by Benoit Pimpaud / @Ben8t",color="") + theme_ipsum_rc()
